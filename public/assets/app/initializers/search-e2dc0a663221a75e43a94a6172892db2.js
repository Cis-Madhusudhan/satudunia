(function(a){a.fn.searcher=function(b){var c={timeout:500,threshold:100,minLength:1,extraParams:{},url:"",target:a("body"),behaviour:"live",success:function(a){},before_query:function(a){},after_reset:function(a){}},b=a.extend(c,b);return this.each(function(){var c=null,d="",e=b,f=a(this),g=[],h=e.target.html();typeof e.fields=="undefined"&&(e.fields=a(this).find("input[type=text],textarea"));for(var i in e.extraParams)g.push({name:i,value:e.extraParams[i]});var j=function(){e.before_query.call(f,e.target),a.ajax({url:e.url,dataType:"json",type:"GET",data:a.merge(e.fields.serializeArray(),g),success:function(a){e.target.empty(),e.target.append(a.html),e.success(a)}})};a.each(e.fields,function(){if(this.value)return j(),!1});var k=function(){a.each(e.fields,function(){var b=null;a(this).keyup(function(){a(this).val().length<=e.minLength?(e.target.empty(),e.target.append(h),e.after_reset.call(f,e.target)):this.value!=d&&(b&&clearTimeout(b),d=this.value,b=setTimeout(j,e.timeout))})})},l=function(){a.each(e.fields,function(){a(this).blur(function(){a(this).val().length<=e.minLength?(e.target.empty(),e.target.append(h),e.after_reset.call(f,e.target)):this.value!=d&&j()})})};switch(e.behaviour){case"live":k();break;case"focusout":l(),k()}})}})(jQuery);