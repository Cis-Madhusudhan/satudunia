Comments=function(){function b(a){$(".comment-votes form.comment-form button.vote").hide();var b=$(".question_comment_form, .answer_comment_form");b.find(".buttons").hide(),b.delegate("textarea","focus",function(){var a=$(this).parents("form");a.find(".buttons").show(),a.find("textarea").hasClass(a.data("editor"))||(a.find("textarea").addClass(a.data("editor")),Editor.setup(a.find("textarea")))}),$.each($("a.toggle_comments"),function(){var a=$(this),b=a.nextAll("article.read"),c=b.length;if(c<5)a.hide();else{a.show();var d=a.find(".counter").text(c);a.text(d),b.hide(),a.parents(".comments").find("article.comment:last").show()}}),$("a.toggle_comments").click(function(){return $(this).nextAll("article.read").toggle(),!1}),$(".content-panel").on("hover",".comment",function(a,b){var c=a.type=="mouseenter";$(this).find(".comment-votes form.comment-form button.vote").toggle(c)}),$(".content-panel").on("submit",".comment-votes .comment-form",function(a){var b=$(this),c=b.find("button");return c.attr("disabled",!0),c.hide(),$.post(b.attr("action"),b.serialize()+"&"+c.attr("name")+"=1",function(a){a.success?(a.vote_state=="destroyed"?(c.addClass("vote"),c.hide()):(c.removeClass("vote"),c.show()),c.parents(".comment-votes").children(".votes_average").html(a.average),Messages.show(a.message,"notice")):Messages.show(a.message,"error"),c.attr("disabled",!1),c.show()},"json"),!1}),$(".Question-commentable").click(c),$(".content-panel").delegate(".Answer-commentable, .Comment-commentable","click",c),$(".cancel_comment").on("click",function(){var a=$(this).parents("form");a.find(".buttons").hide();var b=a.find(".jHtmlArea");return b.length>0?(b.remove(),a.find(".markdown").append('<textarea class="text_area" cols="auto" id="comment_body" name="comment[body]" placeholder="Add comment" rows="auto"></textarea>')):(a.find(".markdown_toolbar").remove(),a.find("textarea").removeClass("markdown_editor")),!1})}function c(){var a=$(this),b=a.attr("data-commentable"),c=$("form[data-commentable="+b+"]"),d=c.find("textarea");c.slideToggle(),d.focus();var e=window.innerHeight?window.innerHeight:$(window).height(),f=c.offset().top-e/2;return $("html,body").animate({scrollTop:f},1e3),!1}function d(a){}function e(a){var b=$("#"+a.object_id);if(b.length==0){var c=$("."+a.commentable_id),d=c.find(".comments");d.append(a.html),Effects.fade(b)}}function f(a){}function g(a){var b=$("#"+a.object_id);$.trim(b.html())!=a.html&&(b.replaceWith(a.html),Effects.fade(b))}function h(a){}var a=this;return{initializeOnQuestion:b,showCommentForm:c,createOnIndex:d,createOnShow:e,updateOnIndex:f,updateOnShow:g,vote:h}}();