Editor=function(){function b(){e(),d(),$(".markdown code").addClass("prettyprint"),$("textarea").focus(function(){window.onbeforeunload||(window.onbeforeunload=function(){var a=!1;return $("textarea").each(function(){$.trim($(this).val())!=""&&(a=!0)}),a?I18n.on_leave_page:null})})}function c(a){a.hasClass("wysiwyg_editor")?d(a):a.hasClass("markdown_editor")&&e(a)}function d(a){var a=a||$(".wysiwyg_editor");if(!a||a.length==0)return;a.htmlarea({toolbar:[["html"],["bold","italic","underline","strikethrough","|","subscript","superscript"],["increasefontsize","decreasefontsize"],["orderedlist","unorderedlist"],["indent","outdent"],["justifyleft","justifycenter","justifyright"],["link","unlink","image","horizontalrule"],["p","h1","h2","h3","h4","h5","h6"],["cut","copy","paste"],[{css:"removeformat",text:"Remove Format",action:function(a){this.removeFormat()}}]]})}function e(a){var a=a||$(".markdown_editor");if(!a||a.length==0)return;var b=new Showdown.converter,c=null,d=function(a){var d=$(".markdown_preview");d.length>0&&($(".markdown_preview")[0].innerHTML=b.makeHtml(a),$(".markdown_preview.markdown p code").addClass("prettyprint"),c&&clearTimeout(c),c=setTimeout(function(){prettyPrint()},500))},e=a.TextArea({change:d}),f=$.Toolbar(e,{className:"markdown_toolbar"});f.addButton("Italics",function(){this.wrapSelection("*","*")},{id:"markdown_italics_button"}),f.addButton("Bold",function(){this.wrapSelection("**","**")},{id:"markdown_bold_button"}),f.addButton("Link",function(){var a=this.getSelection(),b=prompt("Enter Link URL","");if(b==null)return;this.replaceSelection("["+(a==""?"Link Text":a)+"]("+(b==""?"http://link_url/":b).replace(/^(?!(f|ht)tps?:\/\/)/,"http://")+")")},{id:"markdown_link_button"}),f.addButton("Image",function(){var a=this.getSelection(),b=prompt("Enter Image URL","");if(b==null)return;this.replaceSelection("!["+(a==""?"Image Alt Text":a)+"]("+(b==""?"http://image_url/":b).replace(/^(?!(f|ht)tps?:\/\/)/,"http://")+")")},{id:"markdown_image_button"}),f.addButton("Heading",function(){var a=this.getSelection();a==""&&(a="Heading"),this.replaceSelection("##"+a+"##")},{id:"markdown_heading_button"}),f.addButton("Unordered List",function(a){this.collectFromEachSelectedLine(function(b){return a.shiftKey?b.match(/^\*{2,}/)?b.replace(/^\*/,""):b.replace(/^\*\s/,""):(b.match(/\*+\s/)?"*":"* ")+b})},{id:"markdown_unordered_list_button"}),f.addButton("Ordered List",function(a){var b=0;this.collectFromEachSelectedLine(function(c){if(!c.match(/^\s+$/))return++b,a.shiftKey?c.replace(/^\d+\.\s/,""):(c.match(/\d+\.\s/)?"":b+". ")+c})},{id:"markdown_ordered_list_button"}),f.addButton("Block Quote",function(a){this.collectFromEachSelectedLine(function(b){return a.shiftKey?b.replace(/^\> /,""):"> "+b})},{id:"markdown_quote_button"}),f.addButton("Code Block",function(a){this.collectFromEachSelectedLine(function(b){return a.shiftKey?b.replace(/    /,""):"    "+b})},{id:"markdown_code_button"}),f.addButton("Latex",function(a){this.wrapSelection("$$","$$")},{id:"markdown_latex_button"}),f.addButton("Help",function(){window.open("http://daringfireball.net/projects/markdown/dingus")},{id:"markdown_help_button"})}var a=this;return{initialize:b,setup:c,setupWysiwyg:d,setupEditor:e}}();