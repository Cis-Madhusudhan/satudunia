ShapadoSocket=function(){function c(){WEB_SOCKET_SWF_LOCATION="/javascripts/web-socket-js/WebSocketMain.swf",b=$("#websocket"),this.error_count=0,this.ws=new WebSocket("ws://"+b.data("host")+":34567/"),this.socket_key=null,this.ws.onmessage=function(a){ShapadoSocket.parse(a.data)},window.webSocketError=function(a){console.error(decodeURIComponent(a)),ShapadoSocket.error_count+=1},this.ws.onclose=function(){ShapadoSocket.error_count<3&&setTimeout(ShapadoSocket.initialize,5e3)},this.ws.onopen=function(){ShapadoSocket.send({id:"start",key:b.data("key"),channel_id:b.data("group")})}}function d(a,b){$("#chat_div").chatbox("option","boxManager").addMsg(a,b)}function e(a){var a=JSON.parse(a);window.console&&console.log("received: "),window.console&&console.log(a);switch(a.id){case"chatmessage":d(a.from,a.message);break;case"newquestion":ShapadoUI.newQuestion(a);break;case"updatequestion":ShapadoUI.updateQuestion(a);break;case"destroyquestion":ShapadoUI.deleteQuestion(a);break;case"newanswer":ShapadoUI.newAnswer(a);break;case"updateanswer":ShapadoUI.updateAnswer(a);break;case"vote":ShapadoUI.vote(a);break;case"newcomment":ShapadoUI.newComment(a);break;case"updatedcomment":ShapadoUI.updateComment(a);break;case"newactivity":ShapadoUI.newActivity(a)}}function f(a){this.ws.send(JSON.stringify(a))}var a=this,b;return{initialize:c,addChatMessage:d,parse:e,send:f}}();