LocalStorage=function(){function b(){Modernizr.localstorage&&(f(),d())}function c(a,b){if(e()){var c=localStorage[a];if(typeof c=="string"){var d=i(a);d=$.map(d,function(a,c){return a.id==b?null:a}),h(a,d)}}}function d(){$("form").live("submit",function(){var a=$(this).find("textarea");c(location.href,a.attr("id")),window.onbeforeunload=null}),$("textarea").live("keyup",function(){var a=$(this).val(),b=$(this).attr("id");g(location.href,b,a)})}function e(){return Modernizr.localstorage&&localStorage.setObject&&localStorage.getObject?!0:!1}function f(){e()&&localStorage[location.href]!=null&&localStorage[location.href]!="null"&&(localStorageArr=i(location.href),$.each(localStorageArr,function(a,b){$("#"+b.id).val(b.value),$("#"+b.id).parents("form.commentForm").show(),$("#"+b.id).parents("form.nestedAnswerForm").show()}))}function g(a,b,d){if(e()){var f=localStorage[a];if($.trim(d)!="")if(f==null||f=="null"||typeof f=="undefined")h(a,[{id:b,value:d}]);else{var g=i(a),j=!1;g=$.map(g,function(a,c){return a.id==b&&(a.value=d,j=!0),a}),j||(g=$.merge(g,[{id:b,value:d}])),h(a,g)}else c(a,b)}}var a=this;if(Modernizr.localstorage){function h(a,b){this.setItem(a,JSON.stringify(b))}function i(a){return JSON.parse(this.getItem(a))}}return{initialize:b,remove:c,initializeTextAreas:d,hasStorage:e,loadTextareas:f,add:g}}();