/*
* jHtmlArea 0.7.0 - WYSIWYG Html Editor jQuery Plugin
* Copyright (c) 2009 Chris Pietschmann
* http://jhtmlarea.codeplex.com
* Licensed under the Microsoft Reciprocal License (Ms-RL)
* http://jhtmlarea.codeplex.com/license
*/
(function(a){a.fn.htmlarea=function(a){if(a&&typeof a=="string"){var c=[];for(var d=1;d<arguments.length;d++)c.push(arguments[d]);var e=b(this[0]),f=e[a];if(f)return f.apply(e,c)}return this.each(function(){b(this,a)})};var b=window.jHtmlArea=function(a,c){return a.jquery?b(a[0]):a.jhtmlareaObject?a.jhtmlareaObject:new b.fn.init(a,c)};b.fn=b.prototype={jhtmlarea:"0.7.0",init:function(d,e){if(d.nodeName.toLowerCase()==="textarea"){var f=a.extend({},b.defaultOptions,e);d.jhtmlareaObject=this;var g=this.textarea=a(d),h=this.container=a("<div/>").addClass("jHtmlArea").width(g.width()).insertAfter(g),i=this.toolbar=a("<div/>").addClass("ToolBar").appendTo(h);c.initToolBar.call(this,f);var j=this.iframe=a("<iframe/>").height(g.height());j.width(g.width()-(a.browser.msie?0:4));var k=this.htmlarea=a("<div/>").append(j);h.append(k).append(g.hide()),c.initEditor.call(this,f),c.attachEditorEvents.call(this),j.height(j.height()-i.height()),i.width(g.width()-2),f.loaded&&f.loaded.call(this)}},dispose:function(){this.textarea.show().insertAfter(this.container),this.container.remove(),this.textarea[0].jhtmlareaObject=null},execCommand:function(a,b,c){this.iframe[0].contentWindow.focus(),this.editor.execCommand(a,b||!1,c||null),this.updateTextArea()},ec:function(a,b,c){this.execCommand(a,b,c)},queryCommandValue:function(a){return this.iframe[0].contentWindow.focus(),this.editor.queryCommandValue(a)},qc:function(a){return this.queryCommandValue(a)},getSelectedHTML:function(){if(a.browser.msie)return this.getRange().htmlText;var b=this.getRange().cloneContents();return a("<p/>").append(a(b)).html()},getSelection:function(){return a.browser.msie?this.editor.selection:this.iframe[0].contentDocument.defaultView.getSelection()},getRange:function(){var a=this.getSelection();return a?a.getRangeAt?a.getRangeAt(0):a.createRange():null},html:function(a){if(!a)return toHtmlString();this.pasteHTML(a)},pasteHTML:function(b){this.iframe[0].contentWindow.focus();var c=this.getRange();a.browser.msie?c.pasteHTML(b):a.browser.mozilla?(c.deleteContents(),c.insertNode(a(b.indexOf("<")!=0?a("<span/>").append(b):b)[0])):(c.deleteContents(),c.insertNode(a(this.iframe[0].contentWindow.document.createElement("span")).append(a(b.indexOf("<")!=0?"<span>"+b+"</span>":b))[0])),c.collapse(!1),c.select()},cut:function(){this.ec("cut")},copy:function(){this.ec("copy")},paste:function(){this.ec("paste")},bold:function(){this.ec("bold")},italic:function(){this.ec("italic")},underline:function(){this.ec("underline")},strikeThrough:function(){this.ec("strikethrough")},image:function(b){a.browser.msie&&!b?this.ec("insertImage",!0):this.ec("insertImage",!1,b||prompt("Image URL:","http://"))},removeFormat:function(){this.ec("removeFormat",!1,[]),this.unlink()},link:function(){a.browser.msie?this.ec("createLink",!0):this.ec("createLink",!1,prompt("Link URL:","http://"))},unlink:function(){this.ec("unlink",!1,[])},orderedList:function(){this.ec("insertorderedlist")},unorderedList:function(){this.ec("insertunorderedlist")},superscript:function(){this.ec("superscript")},subscript:function(){this.ec("subscript")},p:function(){this.formatBlock("<p>")},h1:function(){this.heading(1)},h2:function(){this.heading(2)},h3:function(){this.heading(3)},h4:function(){this.heading(4)},h5:function(){this.heading(5)},h6:function(){this.heading(6)},heading:function(b){this.formatBlock(a.browser.msie?"Heading "+b:"h"+b)},indent:function(){this.ec("indent")},outdent:function(){this.ec("outdent")},insertHorizontalRule:function(){this.ec("insertHorizontalRule",!1,"ht")},justifyLeft:function(){this.ec("justifyLeft")},justifyCenter:function(){this.ec("justifyCenter")},justifyRight:function(){this.ec("justifyRight")},increaseFontSize:function(){a.browser.msie?this.ec("fontSize",!1,this.qc("fontSize")+1):a.browser.safari?this.getRange().surroundContents(a(this.iframe[0].contentWindow.document.createElement("span")).css("font-size","larger")[0]):this.ec("increaseFontSize",!1,"big")},decreaseFontSize:function(){a.browser.msie?this.ec("fontSize",!1,this.qc("fontSize")-1):a.browser.safari?this.getRange().surroundContents(a(this.iframe[0].contentWindow.document.createElement("span")).css("font-size","smaller")[0]):this.ec("decreaseFontSize",!1,"small")},forecolor:function(a){this.ec("foreColor",!1,a||prompt("Enter HTML Color:","#"))},formatBlock:function(a){this.ec("formatblock",!1,a||null)},showHTMLView:function(){this.updateTextArea(),this.textarea.show(),this.htmlarea.hide(),a("ul li:not(li:has(a.html))",this.toolbar).hide(),a("ul:not(:has(:visible))",this.toolbar).hide(),a("ul li a.html",this.toolbar).addClass("highlighted")},hideHTMLView:function(){this.updateHtmlArea(),this.textarea.hide(),this.htmlarea.show(),a("ul",this.toolbar).show(),a("ul li",this.toolbar).show().find("a.html").removeClass("highlighted")},toggleHTMLView:function(){this.textarea.is(":hidden")?this.showHTMLView():this.hideHTMLView()},toHtmlString:function(){return this.editor.body.innerHTML},toString:function(){return this.editor.body.innerText},updateTextArea:function(){this.textarea.val(this.toHtmlString())},updateHtmlArea:function(){this.editor.body.innerHTML=this.textarea.val()}},b.fn.init.prototype=b.fn,b.defaultOptions={toolbar:[["html"],["bold","italic","underline","strikethrough","|","subscript","superscript"],["increasefontsize","decreasefontsize"],["orderedlist","unorderedlist"],["indent","outdent"],["justifyleft","justifycenter","justifyright"],["link","unlink","image","horizontalrule"],["p","h1","h2","h3","h4","h5","h6"],["cut","copy","paste"]],css:null,toolbarText:{bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strike-Through",cut:"Cut",copy:"Copy",paste:"Paste",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",p:"Paragraph",indent:"Indent",outdent:"Outdent",horizontalrule:"Insert Horizontal Rule",justifyleft:"Left Justify",justifycenter:"Center Justify",justifyright:"Right Justify",increasefontsize:"Increase Font Size",decreasefontsize:"Decrease Font Size",forecolor:"Text Color",link:"Insert Link",unlink:"Remove Link",image:"Insert Image",orderedlist:"Insert Ordered List",unorderedlist:"Insert Unordered List",subscript:"Subscript",superscript:"Superscript",html:"Show/Hide HTML Source View"}};var c={toolbarButtons:{strikethrough:"strikeThrough",orderedlist:"orderedList",unorderedlist:"unorderedList",horizontalrule:"insertHorizontalRule",justifyleft:"justifyLeft",justifycenter:"justifyCenter",justifyright:"justifyRight",increasefontsize:"increaseFontSize",decreasefontsize:"decreaseFontSize",html:function(a){this.toggleHTMLView()}},initEditor:function(a){var b=this.editor=this.iframe[0].contentWindow.document;b.designMode="on",b.open(),b.write(this.textarea.val()),b.close();if(a.css){var c=b.createElement("link");c.rel="stylesheet",c.type="text/css",c.href=a.css,b.getElementsByTagName("head")[0].appendChild(c)}},initToolBar:function(b){function f(f){var g=a("<ul/>").appendTo(d.toolbar);for(var h=0;h<f.length;h++){var i=f[h];if((typeof i).toLowerCase()==="string")if(i==="|")g.append(a('<li class="separator"/>'));else{var j=function(a){var b=c.toolbarButtons[a]||a;return(typeof b).toLowerCase()==="function"?function(a){b.call(this,a)}:function(){this[b](),this.editor.body.focus()}}(i.toLowerCase()),k=b.toolbarText[i.toLowerCase()];g.append(e(i.toLowerCase(),k||i,j))}else g.append(e(i.css,i.text,i.action))}}var d=this,e=function(b,c,e){return a("<li/>").append(a("<a href='javascript:void(0);'/>").addClass(b).attr("title",c).click(function(){e.call(d,a(this))}))};if(b.toolbar.length!==0&&c.isArray(b.toolbar[0]))for(var g=0;g<b.toolbar.length;g++)f(b.toolbar[g]);else f(b.toolbar)},attachEditorEvents:function(){var b=this,c=function(){b.updateHtmlArea()};this.textarea.click(c).keyup(c).keydown(c).mousedown(c).blur(c);var d=function(){b.updateTextArea()};a(this.editor.body).click(d).keyup(d).keydown(d).mousedown(d).blur(d),a("form").submit(function(){b.toggleHTMLView(),b.toggleHTMLView()});if(window.__doPostBack){var e=__doPostBack;window.__doPostBack=function(){return b&&b.toggleHTMLView&&(b.toggleHTMLView(),b.toggleHTMLView()),e.apply(window,arguments)}}},isArray:function(a){return a&&typeof a=="object"&&typeof a.length=="number"&&typeof a.splice=="function"&&!a.propertyIsEnumerable("length")}}})(jQuery);